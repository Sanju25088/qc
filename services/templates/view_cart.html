{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Your Shopping Cart</h2>
    
    {% if cart_items %}
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in cart_items %}
                            <tr>
                                <td>{{ item.product_name }}</td>
                                <td>₹{{ item.price }}</td>
                                <td>
                                    <form method="POST" action="{% url 'update_cart' item.id %}" class="d-inline">
                                        {% csrf_token %}
                                        <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.max_quantity }}" class="form-control form-control-sm" style="width: 70px;">
                                        <button type="submit" class="btn btn-sm btn-outline-primary mt-1">Update</button>
                                    </form>
                                </td>
                                <td>₹{{ item.total_price }}</td>
                                <td>
                                    <form method="POST" action="{% url 'remove_from_cart' item.id %}" class="d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-danger">Remove</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Order Summary</h5>
                    <hr>
                    <div class="mb-3">
                        <h6>Choose Service Type:</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="service_type" id="pick_up" value="pick_up" required>
                            <label class="form-check-label" for="pick_up">
                                <i class="ti-shopping-cart"></i> Pick Up
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="service_type" id="home_delivery" value="home_delivery" required>
                            <label class="form-check-label" for="home_delivery">
                                <i class="ti-truck"></i> Home Delivery
                            </label>
                        </div>
                        <p id="service-error" class="text-danger" style="display: none;">
                            <i class="ti-alert"></i> Please select a service type.
                        </p>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal:</span>
                        <span>₹{{ subtotal }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Delivery Charge:</span>
                        <span>₹{{ delivery_charge }}</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <strong>Total:</strong>
                        <strong>₹{{ total }}</strong>
                    </div>
                    <form method="POST" action="{% url 'checkout' %}" id="checkout-form" onsubmit="return validateServiceType()">
                        {% csrf_token %}
                        <input type="hidden" name="service_type" id="selected_service_type">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="ti-shopping-cart-full"></i> Place Order
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        Your cart is empty. <a href="{% url 'customer_dashboard' %}">Continue shopping</a>
    </div>
    {% endif %}
</div>

<script>
    // Function to validate service type selection
    function validateServiceType() {
        const serviceType = document.querySelector('input[name="service_type"]:checked');
        const errorMsg = document.getElementById("service-error");
        const hiddenInput = document.getElementById("selected_service_type");
        
        if (!serviceType) {
            errorMsg.style.display = "block";
            // Add shake animation to the error message
            errorMsg.classList.add('shake');
            setTimeout(() => {
                errorMsg.classList.remove('shake');
            }, 500);
            return false;
        }
        
        errorMsg.style.display = "none";
        hiddenInput.value = serviceType.value;
        return true;
    }

    // Add event listeners to radio buttons to clear error when selection is made
    document.querySelectorAll('input[name="service_type"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const errorMsg = document.getElementById("service-error");
            errorMsg.style.display = "none";
        });
    });

    // Add shake animation style
    const style = document.createElement('style');
    style.textContent = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %} 