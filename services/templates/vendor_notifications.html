<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Vendor Notifications - Quick Connect</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="/media/assets1/vendors/feather/feather.css">
  <link rel="stylesheet" href="/media/assets1/vendors/ti-icons/css/themify-icons.css">
  <link rel="stylesheet" href="/media/assets1/vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="/media/assets1/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
  <link rel="stylesheet" href="/media/assets1/vendors/ti-icons/css/themify-icons.css">
  <link rel="stylesheet" type="text/media/assets1/css" href="/media/assets1/js/select.dataTables.min.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="/media/assets1/css/vertical-layout-light/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="/media/assets1/images/my_logo3.png" />
  <style>
    .notification-card {
      transition: all 0.3s ease;
      border-left: 4px solid #5B63FE;
      margin-bottom: 15px;
    }
    
    .notification-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .notification-card.unread {
      background-color: rgba(91, 99, 254, 0.05);
    }
    
    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .notification-time {
      color: #6c757d;
      font-size: 12px;
    }
    
    .notification-message {
      white-space: pre-line;
      margin-bottom: 10px;
    }
    
    .notification-type {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      margin-right: 10px;
      color: white;
    }
    
    .type-booking {
      background-color: #4CAF50;
    }
    
    .type-cart_update {
      background-color: #FF9800;
    }
    
    .type-status_update {
      background-color: #2196F3;
    }
    
    .type-general {
      background-color: #9E9E9E;
    }
    
    .notification-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }
    
    .custom-tabs {
      margin-bottom: 20px;
    }
    
    .custom-tabs .nav-link {
      border: none;
      padding: 10px 20px;
      border-radius: 0;
      font-weight: 500;
      color: #6c757d;
      border-bottom: 3px solid transparent;
    }
    
    .custom-tabs .nav-link.active {
      color: #5B63FE;
      background: transparent;
      border-bottom: 3px solid #5B63FE;
    }
    
    .tab-count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-color: #5B63FE;
      color: white;
      font-size: 12px;
      margin-left: 5px;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
    }
    
    .empty-state i {
      font-size: 4rem;
      color: #e0e0e0;
      margin-bottom: 20px;
    }
    
    .empty-state h4 {
      color: #6c757d;
      margin-bottom: 10px;
    }
    
    .notification-refresh {
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .notification-refresh:hover {
      transform: rotate(90deg);
    }
    
    /* Make notification content scrollable if too long */
    .notification-content {
      max-height: 200px;
      overflow-y: auto;
    }
    
    @keyframes highlight {
      0% { background-color: rgba(91, 99, 254, 0.2); }
      100% { background-color: rgba(91, 99, 254, 0); }
    }
    
    .highlight-animation {
      animation: highlight 2s ease-out;
    }
  </style>
</head>

<body>
  <div class="container-scroller">
    <!-- Navigation bar - similar to other pages -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo mr-5" href="{% url 'vendor_dashboard' %}">
          <img src="/media/assets1/images/qc3.png" class="mr-2" alt="logo"/>
        </a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="icon-menu"></span>
        </button>
        <ul class="navbar-nav mr-lg-2">
          <li class="nav-item nav-search d-none d-lg-block">
            <div class="input-group">
              <div class="input-group-prepend hover-cursor" id="navbar-search-icon">
                <span class="input-group-text" id="search">
                  <i class="icon-search"></i>
                </span>
              </div>
              <input type="text" class="form-control" id="navbar-search-input" placeholder="Search notifications..." aria-label="search" aria-describedby="search">
            </div>
          </li>
        </ul>
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item dropdown">
            <a class="nav-link" href="{% url 'vendor_dashboard' %}">
              <i class="ti-home mx-0"></i> Dashboard
            </a>
          </li>
          <li class="nav-item nav-profile dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" id="profileDropdown">
              <img src="{{ user.profile_image.url }}" alt="profile"/>
            </a>
            <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
              <a class="dropdown-item" href="{% url 'logout' %}">
                <i class="ti-power-off text-primary"></i>
                Logout
              </a>
            </div>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid page-body-wrapper">
      <div class="main-panel" style="width: 100%;">
        <div class="content-wrapper">
          <div class="row">
            <div class="col-md-12 grid-margin">
              <div class="row">
                <div class="col-12 col-xl-8 mb-4 mb-xl-0">
                  <h3 class="font-weight-bold text-primary">Notifications</h3>
                  <h6 class="font-weight-normal mb-0">Stay updated with your business activities</h6>
                </div>
                <div class="col-12 col-xl-4">
                  <div class="justify-content-end d-flex">
                    <div class="dropdown flex-md-grow-1 flex-xl-grow-0">
                      <form method="POST" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="mark_all_read" value="true">
                        <button type="submit" class="btn btn-outline-primary btn-sm">
                          <i class="ti-check-box mr-1"></i> Mark All as Read
                        </button>
                      </form>
                      <button class="btn btn-sm btn-icon-text btn-primary ml-2 notification-refresh" id="refreshNotifications">
                        <i class="ti-reload"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Notification Tabs -->
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-body">
                  <ul class="nav nav-tabs custom-tabs" id="notificationTabs" role="tablist">
                    <li class="nav-item">
                      <a class="nav-link active" id="all-tab" data-toggle="tab" href="#all" role="tab" aria-controls="all" aria-selected="true">
                        All
                        <span class="tab-count">{{ notifications.count }}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="cart-tab" data-toggle="tab" href="#cart" role="tab" aria-controls="cart" aria-selected="false">
                        Cart Activity
                        <span class="tab-count">{{ cart_notifications.count }}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="booking-tab" data-toggle="tab" href="#booking" role="tab" aria-controls="booking" aria-selected="false">
                        Orders
                        <span class="tab-count">{{ booking_notifications.count }}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="status-tab" data-toggle="tab" href="#status" role="tab" aria-controls="status" aria-selected="false">
                        Status Updates
                        <span class="tab-count">{{ status_notifications.count }}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="unread-tab" data-toggle="tab" href="#unread" role="tab" aria-controls="unread" aria-selected="false">
                        Unread
                        <span class="tab-count">{{ unread_count }}</span>
                      </a>
                    </li>
                  </ul>
                  
                  <!-- Tab Content -->
                  <div class="tab-content" id="notificationTabContent">
                    <!-- All Notifications Tab -->
                    <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="all-tab">
                      {% if notifications %}
                        <div class="notification-list">
                          {% for notification in notifications %}
                            <div class="card notification-card {% if not notification.is_read %}unread{% endif %}" id="notification-{{ notification.id }}">
                              <div class="card-body">
                                <div class="notification-header">
                                  <div>
                                    <span class="notification-type type-{{ notification.action_type }}">
                                      {% if notification.action_type == 'booking' %}
                                        <i class="ti-shopping-cart"></i> Order
                                      {% elif notification.action_type == 'cart_update' %}
                                        <i class="ti-shopping-cart-full"></i> Cart
                                      {% elif notification.action_type == 'status_update' %}
                                        <i class="ti-reload"></i> Status
                                      {% else %}
                                        <i class="ti-bell"></i> General
                                      {% endif %}
                                    </span>
                                    <span class="font-weight-bold">{{ notification.sender.first_name }} {{ notification.sender.last_name }}</span>
                                  </div>
                                  <span class="notification-time">{{ notification.timestamp|date:"M d, Y" }} at {{ notification.timestamp|time:"h:i A" }}</span>
                                </div>
                                <div class="notification-content">
                                  <p class="notification-message">{{ notification.message }}</p>
                                </div>
                                <div class="notification-actions">
                                  {% if not notification.is_read %}
                                    <a href="{% url 'mark_notification_read' notification.id %}" class="btn btn-sm btn-outline-primary">
                                      <i class="ti-check"></i> Mark as Read
                                    </a>
                                  {% endif %}
                                </div>
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      {% else %}
                        <div class="empty-state">
                          <i class="ti-bell"></i>
                          <h4>No notifications yet</h4>
                          <p>When you receive notifications, they will appear here</p>
                        </div>
                      {% endif %}
                    </div>
                    
                    <!-- Cart Activities Tab -->
                    <div class="tab-pane fade" id="cart" role="tabpanel" aria-labelledby="cart-tab">
                      {% if cart_notifications %}
                        <div class="notification-list">
                          {% for notification in cart_notifications %}
                            <div class="card notification-card {% if not notification.is_read %}unread{% endif %}">
                              <div class="card-body">
                                <div class="notification-header">
                                  <div>
                                    <span class="notification-type type-cart_update">
                                      <i class="ti-shopping-cart-full"></i> Cart
                                    </span>
                                    <span class="font-weight-bold">{{ notification.sender.first_name }} {{ notification.sender.last_name }}</span>
                                  </div>
                                  <span class="notification-time">{{ notification.timestamp|date:"M d, Y" }} at {{ notification.timestamp|time:"h:i A" }}</span>
                                </div>
                                <div class="notification-content">
                                  <p class="notification-message">{{ notification.message }}</p>
                                </div>
                                <div class="notification-actions">
                                  {% if not notification.is_read %}
                                    <a href="{% url 'mark_notification_read' notification.id %}" class="btn btn-sm btn-outline-primary">
                                      <i class="ti-check"></i> Mark as Read
                                    </a>
                                  {% endif %}
                                </div>
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      {% else %}
                        <div class="empty-state">
                          <i class="ti-shopping-cart"></i>
                          <h4>No cart activities</h4>
                          <p>When customers add items to their cart, you'll see notifications here</p>
                        </div>
                      {% endif %}
                    </div>
                    
                    <!-- Bookings Tab -->
                    <div class="tab-pane fade" id="booking" role="tabpanel" aria-labelledby="booking-tab">
                      {% if booking_notifications %}
                        <div class="notification-list">
                          {% for notification in booking_notifications %}
                            <div class="card notification-card {% if not notification.is_read %}unread{% endif %}">
                              <div class="card-body">
                                <div class="notification-header">
                                  <div>
                                    <span class="notification-type type-booking">
                                      <i class="ti-shopping-cart"></i> Order
                                    </span>
                                    <span class="font-weight-bold">{{ notification.sender.first_name }} {{ notification.sender.last_name }}</span>
                                  </div>
                                  <span class="notification-time">{{ notification.timestamp|date:"M d, Y" }} at {{ notification.timestamp|time:"h:i A" }}</span>
                                </div>
                                <div class="notification-content">
                                  <p class="notification-message">{{ notification.message }}</p>
                                </div>
                                <div class="notification-actions">
                                  {% if not notification.is_read %}
                                    <a href="{% url 'mark_notification_read' notification.id %}" class="btn btn-sm btn-outline-primary">
                                      <i class="ti-check"></i> Mark as Read
                                    </a>
                                  {% endif %}
                                </div>
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      {% else %}
                        <div class="empty-state">
                          <i class="ti-package"></i>
                          <h4>No order notifications</h4>
                          <p>When you receive new orders, they will appear here</p>
                        </div>
                      {% endif %}
                    </div>
                    
                    <!-- Status Updates Tab -->
                    <div class="tab-pane fade" id="status" role="tabpanel" aria-labelledby="status-tab">
                      {% if status_notifications %}
                        <div class="notification-list">
                          {% for notification in status_notifications %}
                            <div class="card notification-card {% if not notification.is_read %}unread{% endif %}">
                              <div class="card-body">
                                <div class="notification-header">
                                  <div>
                                    <span class="notification-type type-status_update">
                                      <i class="ti-reload"></i> Status
                                    </span>
                                    <span class="font-weight-bold">{{ notification.sender.first_name }} {{ notification.sender.last_name }}</span>
                                  </div>
                                  <span class="notification-time">{{ notification.timestamp|date:"M d, Y" }} at {{ notification.timestamp|time:"h:i A" }}</span>
                                </div>
                                <div class="notification-content">
                                  <p class="notification-message">{{ notification.message }}</p>
                                </div>
                                <div class="notification-actions">
                                  {% if not notification.is_read %}
                                    <a href="{% url 'mark_notification_read' notification.id %}" class="btn btn-sm btn-outline-primary">
                                      <i class="ti-check"></i> Mark as Read
                                    </a>
                                  {% endif %}
                                </div>
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      {% else %}
                        <div class="empty-state">
                          <i class="ti-reload"></i>
                          <h4>No status updates</h4>
                          <p>Status update notifications will appear here</p>
                        </div>
                      {% endif %}
                    </div>
                    
                    <!-- Unread Tab -->
                    <div class="tab-pane fade" id="unread" role="tabpanel" aria-labelledby="unread-tab">
                      {% if unread_count > 0 %}
                        <div class="notification-list">
                          {% for notification in notifications %}
                            {% if not notification.is_read %}
                              <div class="card notification-card unread">
                                <div class="card-body">
                                  <div class="notification-header">
                                    <div>
                                      <span class="notification-type type-{{ notification.action_type }}">
                                        {% if notification.action_type == 'booking' %}
                                          <i class="ti-shopping-cart"></i> Order
                                        {% elif notification.action_type == 'cart_update' %}
                                          <i class="ti-shopping-cart-full"></i> Cart
                                        {% elif notification.action_type == 'status_update' %}
                                          <i class="ti-reload"></i> Status
                                        {% else %}
                                          <i class="ti-bell"></i> General
                                        {% endif %}
                                      </span>
                                      <span class="font-weight-bold">{{ notification.sender.first_name }} {{ notification.sender.last_name }}</span>
                                    </div>
                                    <span class="notification-time">{{ notification.timestamp|date:"M d, Y" }} at {{ notification.timestamp|time:"h:i A" }}</span>
                                  </div>
                                  <div class="notification-content">
                                    <p class="notification-message">{{ notification.message }}</p>
                                  </div>
                                  <div class="notification-actions">
                                    <a href="{% url 'mark_notification_read' notification.id %}" class="btn btn-sm btn-outline-primary">
                                      <i class="ti-check"></i> Mark as Read
                                    </a>
                                  </div>
                                </div>
                              </div>
                            {% endif %}
                          {% endfor %}
                        </div>
                      {% else %}
                        <div class="empty-state">
                          <i class="ti-check-box"></i>
                          <h4>No unread notifications</h4>
                          <p>You're all caught up!</p>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright 2023 Quick Connect. All rights reserved.</span>
          </div>
        </footer>
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- plugins:js -->
  <script src="/media/assets1/vendors/js/vendor.bundle.base.js"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="/media/assets1/vendors/chart.js/Chart.min.js"></script>
  <script src="/media/assets1/vendors/datatables.net/jquery.dataTables.js"></script>
  <script src="/media/assets1/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
  <script src="/media/assets1/js/dataTables.select.min.js"></script>
  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="/media/assets1/js/off-canvas.js"></script>
  <script src="/media/assets1/js/hoverable-collapse.js"></script>
  <script src="/media/assets1/js/template.js"></script>
  <script src="/media/assets1/js/settings.js"></script>
  <script src="/media/assets1/js/todolist.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="/media/assets1/js/dashboard.js"></script>
  <script src="/media/assets1/js/Chart.roundedBarCharts.js"></script>
  <!-- End custom js for this page-->
  
  <script>
    // Search functionality for notifications
    document.getElementById('navbar-search-input').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const notifications = document.querySelectorAll('.notification-card');
      
      notifications.forEach(notification => {
        const message = notification.querySelector('.notification-message').textContent.toLowerCase();
        const sender = notification.querySelector('.notification-header .font-weight-bold').textContent.toLowerCase();
        
        if (message.includes(searchTerm) || sender.includes(searchTerm)) {
          notification.style.display = 'block';
        } else {
          notification.style.display = 'none';
        }
      });
    });
    
    // Refresh notifications
    document.getElementById('refreshNotifications').addEventListener('click', function() {
      this.classList.add('fa-spin');
      setTimeout(() => {
        window.location.reload();
      }, 500);
    });
    
    // Check for new notifications every 30 seconds
    function checkForNewNotifications() {
      fetch('{% url "check_new_notifications" %}')
        .then(response => response.json())
        .then(data => {
          if (data.new_notifications > 0) {
            // Update the unread count
            document.querySelector('#unread-tab .tab-count').textContent = data.unread_count;
            
            // Show notification or refresh
            if (confirm(`You have ${data.new_notifications} new notification(s). Would you like to refresh the page?`)) {
              window.location.reload();
            }
          }
        })
        .catch(error => console.error('Error checking for notifications:', error));
    }
    
    // Run initially after 30 seconds and then every 30 seconds
    setTimeout(() => {
      setInterval(checkForNewNotifications, 30000);
    }, 30000);
  </script>
</body>

</html>
